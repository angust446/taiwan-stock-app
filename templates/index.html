<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>å°è‚¡ä¸»åŠ›é›·é”</title>
<style>
body {
    font-family: Arial;
    background: #f5f5f5;
    padding: 30px;
}
.box {
    background: white;
    padding: 20px;
    border-radius: 8px;
    max-width: 900px;
}
table {
    border-collapse: collapse;
    width: 100%;
    margin-top: 20px;
}
th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: center;
}
th {
    background: #eee;
}
.green { color: green; font-weight: bold; }
.yellow { color: orange; font-weight: bold; }
.gray { color: gray; }

.bar-container {
    width: 150px;
    background: #eee;
    border-radius: 4px;
    overflow: hidden;
    margin: auto;
}
.bar {
    height: 14px;
    background: steelblue;
}
.bar.high {
    background: red;
}
</style>
</head>

<body>
<div class="box">
<h1>ğŸ“ˆ å°è‚¡ä¸»åŠ›ç›£æ§ç³»çµ±</h1>

<!-- ğŸ” æ‰‹å‹•æœå°‹ -->
<form method="post">
    <input name="stock_id" placeholder="è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼ï¼Œä¾‹å¦‚ 2330" required>
    <button type="submit">æŸ¥è©¢</button>
</form>

{% if error %}
<p style="color:red;">{{ error }}</p>
{% endif %}

{% if stock %}
<hr>
<h3>ğŸ” æŸ¥è©¢çµæœ</h3>
<p>è‚¡ç¥¨ä»£ç¢¼ï¼š{{ stock.code }}</p>
<p>æœ€æ–°åƒ¹æ ¼ï¼š{{ stock.price }}</p>
<p><strong>{{ stock.status }}</strong></p>

<div class="bar-container">
    <div class="bar {% if stock.volume_ratio >= 2 %}high{% endif %}"
         style="width: {{ stock.volume_ratio * 50 }}px"></div>
</div>
<p>æˆäº¤é‡å¼·åº¦ï¼š{{ stock.volume_ratio }}x</p>
{% endif %}

<hr>
<h2>ğŸš¨ ä¸»åŠ›é›·é”ï¼ˆè‡ªå‹•åˆ·æ–°ï¼‰</h2>
<p>æ¯ 20 ç§’æ›´æ–°</p>

<table>
<thead>
<tr>
<th>è‚¡ç¥¨</th>
<th>åƒ¹æ ¼</th>
<th>æˆäº¤é‡å¼·åº¦</th>
<th>ä¸»åŠ›ç‹€æ…‹</th>
</tr>
</thead>
<tbody id="radar"></tbody>
</table>
</div>

<script>
function loadRadar() {
    fetch("/api/radar")
        .then(res => res.json())
        .then(data => {
            const tbody = document.getElementById("radar");
            tbody.innerHTML = "";

            data.forEach(stock => {
                let cls = "gray";
                if (stock.status.includes("ğŸŸ¢")) cls = "green";
                if (stock.status.includes("ğŸŸ¡")) cls = "yellow";

                const width = Math.min(stock.volume_ratio * 50, 150);
                const barClass = stock.volume_ratio >= 2 ? "bar high" : "bar";

                tbody.innerHTML += `
                    <tr>
                        <td>${stock.code} ${stock.name}</td>
                        <td>${stock.price}</td>
                        <td>
                            <div class="bar-container">
                                <div class="${barClass}" style="width:${width}px"></div>
                            </div>
                            ${stock.volume_ratio}x
                        </td>
                        <td class="${cls}">${stock.status}</td>
                    </tr>
                `;
            });
        });
}

loadRadar();
setInterval(loadRadar, 20000);
</script>
</body>
</html>